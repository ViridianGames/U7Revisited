  .funcnumber 0311H  ;* Orb of the moons.
  .data
L0000: db '@It work before.@'
L0011: db 00
L0012: db '@How odd!@'
L001C: db 00
L001D: db '@Let thyself enter.@'
L0031: db 00
L0032: db '@No, Avatar.@'
L003F: db 00
  .code
  .argc 0001H
  .localc 0011H
  .externsize 0006H
  .extern 08FEH
  .extern 093EH
  .extern 0822H
  .extern 0821H
  .extern 0826H
  .extern 0824H
0000: 48   push eventid
0001: 1F 01 00   pushi 0001H   ; 1
0004: 22   cmpeq
0005: 05 8D 02   jne 0295
0008: 42 04 00   pushf flag:[0004]
000B: 05 0D 00   jne 001B
000E: 1D 00 00   pushs L0000   ; @It work before.@
0011: 1D 12 00   pushs L0012   ; @How odd!@
0014: 1E 02 00   arrc 0002H   ; 2
0017: 24 00 00   call [0000]   ; 08FEH
001A: 2C   db 2c ???
001B: 42 57 00   pushf flag:[0057]
001E: 24 01 00   call [0001]   ; 093EH
0021: 10   not
0022: 0F   or
0023: 05 6F 02   jne 0295
0026: 38 33 00 00  callis _ItemSelectModal@0  ; 0033
002A: 12 00 00   pop [0000]
002D: 21 00 00   push [0000]
0030: 24 02 00   call [0002]   ; 0822H
0033: 12 01 00   pop [0001]
0036: 21 01 00   push [0001]
0039: 1F 9C FE   pushi FE9CH   ; -356
003C: 38 1A 00 02  callis 001A, 2  ;* Find dir.
0040: 12 02 00   pop [0002]
0043: 21 02 00   push [0002]
0046: 1F 00 00   pushi 0000H   ; 0
0049: 22   cmpeq
004A: 21 02 00   push [0002]
004D: 1F 04 00   pushi 0004H   ; 4
0050: 22   cmpeq
0051: 0F   or
0052: 05 0F 00   jne 0064
0055: 1F 01 00   pushi 0001H   ; 1
0058: 12 03 00   pop [0003]
005B: 1F 0B 03   pushi 030BH   ; 779
005E: 12 04 00   pop [0004]
0061: 06 0C 00   jmp 0070
0064: 1F 02 00   pushi 0002H   ; 2
0067: 12 03 00   pop [0003]
006A: 1F 9D 00   pushi 009DH   ; 157
006D: 12 04 00   pop [0004]
0070: 21 03 00   push [0003]
0073: 26 01 00   aidx [0001]
0076: 1F 02 00   pushi 0002H   ; 2
0079: 09   add
007A: 21 03 00   push [0003]
007D: 46 01 00   db 46 ???
   dw 0001H   ; 1
0080: 1F 00 00   pushi 0000H   ; 0
0083: 21 04 00   push [0004]
0086: 21 01 00   push [0001]
0089: 38 85 00 03  callis 0085, 3  ;* Not blocked?
008D: 10   not
008E: 05 49 00   jne 00DA
0091: 1F 03 00   pushi 0003H   ; 3
0094: 1F 02 00   pushi 0002H   ; 2
0097: 1F 01 00   pushi 0001H   ; 1
009A: 1E 03 00   arrc 0003H   ; 3
009D: 12 05 00   pop [0005]
00A0: 2E   sloop
00A1: 02 06 00 07 00 08 00 05 00 26 00  db 2 ???
00A2:   db 6
00A3:   db 0
00A4:   db 7
00A5:   db 0
00A6:   db 8
00A7:   db 0
00A8:   db 5
00A9:   db 0
00AA:   db 26
00AB:   db 0
00AC: 1F 03 00   pushi 0003H   ; 3
00AF: 26 01 00   aidx [0001]
00B2: 1F 01 00   pushi 0001H   ; 1
00B5: 09   add
00B6: 1F 03 00   pushi 0003H   ; 3
00B9: 46 01 00   db 46 ???
   dw 0001H   ; 1
00BC: 1F 00 00   pushi 0000H   ; 0
00BF: 21 04 00   push [0004]
00C2: 21 01 00   push [0001]
00C5: 38 85 00 03  callis 0085, 3
00C9: 05 03 00   jne 00CF
00CC: 06 0B 00   jmp 00DA
00CF: 06 CF FF   jmp 00A1
00D2: 1F 00 00   pushi 0000H   ; 0
00D5: 39 6A 00 01  calli 006A, 1
00D9: 2C   db 2c ???
00DA: 39 7E 00 00  calli 007E, 0  ;* ??
00DE: 21 04 00   push [0004]
00E1: 38 24 00 01  callis 0024, 1  ;* Create moongate.
00E5: 12 09 00   pop [0009]
00E8: 21 09 00   push [0009]
00EB: 05 A7 01   jne 0295
00EE: 39 7E 00 00  calli 007E, 0
00F2: 21 01 00   push [0001]
00F5: 38 26 00 01  callis 0026, 1  ;* Set pos.
00F9: 12 0A 00   pop [000A]
00FC: 21 03 00   push [0003]
00FF: 26 01 00   aidx [0001]
0102: 1F 02 00   pushi 0002H   ; 2
0105: 0A   sub
0106: 21 03 00   push [0003]
0109: 46 01 00   db 46 ???
   dw 0001H   ; 1
010C: 1F 00 00   pushi 0000H   ; 0
010F: 1F 33 00   pushi 0033H   ; 51
0112: 39 2E 00 02  calli _PlayMusic@2  ; 002E
0116: 1F 12 00   pushi 0012H   ; 18
0119: 21 09 00   push [0009]
011C: 39 89 00 02  calli 0089, 2  ;* Set flag on moongate.
0120: 21 02 00   push [0002]
0123: 21 09 00   push [0009]
0126: 38 15 00 02  callis 0015, 2  ;* Set quality to dir.
012A: 12 0A 00   pop [000A]
012D: 44 2D   pushw 1F2DH   ; 7981
012F: 1F 03 00   pushi 0003H   ; 3
0132: 1F FF FF   pushi FFFFH   ; -1
0135: 44 0B   pushw 440BH   ; 17419 * Descends.
0137: 44 50   pushw 1F50H   ; 8016
0139: 1F 04 00   pushi 0004H   ; 4
013C: 44 46   pushw 1F46H   ; 8006
013E: 1F 05 00   pushi 0005H   ; 5
0141: 1F F9 FF   pushi FFF9H   ; -7
0144: 44 0B   pushw 1F0BH   ; 7947
0146: 1F 05 00   pushi 0005H   ; 5
0149: 1F 05 00   pushi 0005H   ; 5
014C: 1F FF FF   pushi FFFFH   ; -1
014F: 44 0C   pushw 440CH   ; 17420
0151: 44 4E   pushw 1F4EH   ; 8014
0153: 1F 04 00   pushi 0004H   ; 4
0156: 44 46   pushw 1F46H   ; 8006
0158: 1F 0A 00   pushi 000AH   ; 10   ;* Rises.
015B: 1F FF FF   pushi FFFFH   ; -1
015E: 44 0B   pushw 440BH   ; 17419
0160: 44 4E   pushw 1F4EH   ; 8014
0162: 1F 00 00   pushi 0000H   ; 0
0165: 44 46   pushw 1E46H   ; 7750
0167: 1E 17 00   arrc 0017H   ; 23
016A: 21 09 00   push [0009]
016D: 38 01 00 02  callis 0001, 2
0171: 12 0A 00   pop [000A]
0174: 1F 05 00   pushi 0005H   ; 5
0177: 21 09 00   push [0009]
017A: 1F 9C FE   pushi FE9CH   ; -356
017D: 38 19 00 02  callis 0019, 2  ;* Get distance.
0181: 0A   sub
0182: 12 0B 00   pop [000B]  ;* 5-dist.
0185: 44 30   pushw 2130H   ; 8496
0187: 21 02 00   push [0002]
018A: 09   add
018B: 44 59   pushw 1E59H   ; 7769
018D: 1E 02 00   arrc 0002H   ; 2
0190: 12 0C 00   pop [000C]
0193: 21 0B 00   push [000B]
0196: 1F 00 00   pushi 0000H   ; 0
0199: 16   cmpgt
019A: 05 0F 00   jne 01AC
019D: 21 0C 00   push [000C]
01A0: 21 0B 00   push [000B]
01A3: 44 27   pushw 1E27H   ; 7719
01A5: 1E 02 00   arrc 0002H   ; 2
01A8: 4A   arra
01A9: 12 0C 00   pop [000C]
01AC: 21 0C 00   push [000C]
01AF: 1F 9C FE   pushi FE9CH   ; -356
01B2: 38 01 00 02  callis 0001, 2  ;* Step towards gate.
01B6: 12 0A 00   pop [000A]
01B9: 1F 9C FE   pushi FE9CH   ; -356
01BC: 38 18 00 01  callis 0018, 1
01C0: 12 0D 00   pop [000D]  ;* Av. position.
01C3: 21 03 00   push [0003]
01C6: 1F 01 00   pushi 0001H   ; 1
01C9: 22   cmpeq
01CA: 05 09 00   jne 01D6
01CD: 1F 02 00   pushi 0002H   ; 2
01D0: 12 03 00   pop [0003]
01D3: 06 06 00   jmp 01DC
01D6: 1F 01 00   pushi 0001H   ; 1
01D9: 12 03 00   pop [0003]
01DC: 21 03 00   push [0003]
01DF: 26 01 00   aidx [0001]
01E2: 21 03 00   push [0003]
01E5: 26 0D 00   aidx [000D]
01E8: 17   cmpl
01E9: 05 09 00   jne 01F5
01EC: 1F 01 00   pushi 0001H   ; 1
01EF: 12 0E 00   pop [000E]
01F2: 06 06 00   jmp 01FB
01F5: 1F FF FF   pushi FFFFH   ; -1
01F8: 12 0E 00   pop [000E]
01FB: 21 03 00   push [0003]
01FE: 26 01 00   aidx [0001]
0201: 21 0E 00   push [000E]
0204: 09   add
0205: 21 03 00   push [0003]
0208: 46 01 00   db 46 ???
   dw 0001H   ; 1
020B: 1F 07 00   pushi 0007H   ; 7
020E: 21 09 00   push [0009]
0211: 1F 11 03   pushi 0311H   ; 785
0214: 21 01 00   push [0001]  ;* Walk to here.
0217: 38 7D 00 04  callis 007D, 4
021B: 12 0A 00   pop [000A]
021E: 21 0A 00   push [000A]
0221: 05 6B 00   jne 028F
0224: 1F 08 00   pushi 0008H   ; 8
0227: 21 09 00   push [0009]  ;* Moongate created.
022A: 1F 11 03   pushi 0311H   ; 785 * Orb
022D: 39 8B 00 03  calli 008B, 3
0231: 3E   push itemref
0232: 38 6E 00 01  callis 006E, 1  ;* Orb's owner.
0236: 12 0F 00   pop [000F]
0239: 38 23 00 00  callis _GetPartyMembers@0  ; 0023
023D: 12 10 00   pop [0010]
0240: 1F 01 00   pushi 0001H   ; 1
0243: 1F 00 00   pushi 0000H   ; 0
0246: 16   cmpgt
0247: 05 42 00   jne 028C
024A: 21 0F 00   push [000F] ;* Orb's owner.
024D: 05 1D 00   jne 026D
0250: 21 0F 00   push [000F]
0253: 21 10 00   push [0010] ;* Party.
0256: 30   in
0257: 05 06 00   jne 0260
025A: 06 2F 00   jmp 028C
025D: 06 0A 00   jmp 026A
0260: 21 0F 00   push [000F]
0263: 38 6E 00 01  callis 006E, 1
0267: 12 0F 00   pop [000F]
026A: 06 1C 00   jmp 0289
026D: 3E   push itemref
026E: 39 6F 00 01  calli 006F, 1
0272: 14   push false
0273: 1F 00 00   pushi 0000H   ; 0
0276: 1F 00 00   pushi 0000H   ; 0
0279: 1F 11 03   pushi 0311H   ; 785
027C: 1F 01 00   pushi 0001H   ; 1
027F: 38 2C 00 05  callis 002C, 5
0283: 12 0A 00   pop [000A]
0286: 06 03 00   jmp 028C
0289: 06 B4 FF   jmp 0240
028C: 06 06 00   jmp 0295
028F: 21 09 00   push [0009]
0292: 24 03 00   call [0003]   ; 0821H
0295: 48   push eventid
0296: 1F 08 00   pushi 0008H   ; 8
0299: 22   cmpeq
029A: 05 17 00   jne 02B4
029D: 3E   push itemref
029E: 24 04 00   call [0004]   ; 0826H
02A1: 05 10 00   jne 02B4
02A4: 3E   push itemref
02A5: 24 03 00   call [0003]   ; 0821H
02A8: 1D 1D 00   pushs L001D   ; @Let thyself enter.@
02AB: 1D 32 00   pushs L0032   ; @No, Avatar.@
02AE: 1E 02 00   arrc 0002H   ; 2
02B1: 24 00 00   call [0000]   ; 08FEH
02B4: 48   push eventid
02B5: 1F 07 00   pushi 0007H   ; 7
02B8: 22   cmpeq
02B9: 05 0F 00   jne 02CB
02BC: 3E   push itemref
02BD: 24 04 00   call [0004]   ; 0826H
02C0: 05 08 00   jne 02CB
02C3: 3E   push itemref
02C4: 24 03 00   call [0003]   ; 0821H * Remove gate.
02C7: 3E   push itemref
02C8: 24 05 00   call [0005]   ; 0824H
02CB: 25   ret
